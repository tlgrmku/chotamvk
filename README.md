# Бот Telegram-канала "Чо там Вконтакте?"

## Задача бота копировать посты из новостной ленты Вконтакте и размещать их в Telegram.

### О боте:
 - Весь код написан на Python 3.7
 - Используемые методы из API Вконтакте: newsfeed.get, из Telegram API: sendMessage, sendPhoto, sendAnimation, sendAudio
 - Бот умеет копировать посты не только групп но и посты пользователей которые появляются в вашей ленте
 - Бот проверяет ленту новостей через каждые (STIME) секунд.
 - Кроме Telegram-канала можно копировать посты в Telegram-группу или в личные сообщения в Telegram
 - Скопированные посты в Telegram имеют две кнопки:
 	- "Ссылка на пост" это сформированная ссылка на пост Вконтакте
	- "Обсудить" это ссылка на вашу Telegram-группу (Для GetVkSetTgG.py)
 - Бот использует только одно фото, видео, аудио, gif из поста
 - Бот не использует модули других ботов. Используются только модули requests и стандартные json, re, os, time
 - Бот не копирует посты с репостами и с пометкой "Реклама"
 - Бот не копирует опрос полностью. Только вопрос из опроса
 - GetVkSetTg.py - бот без кнопки "Обсудить", GetVkSetTgG.py - бот с кнопкой "Обсудить"
 
### Пример поста Вконтакте и в Telegram:
![Пример поста Вконтакте и в Telegram](https://github.com/tlgrmku/chotamvk/raw/master/Image.PNG)

### Как использовать бота самому?
	Внимание! С 24.03.2020 бот работает с временными рамками c 07:00 до 00:00 (UTC+5)
 - Для начала Вам нужны:
	- Умение пользоваться поисковиком
	- Токен вашего аккаунта Вконтакте
	- Токен вашего Telegram-бота. Обращаемся к @BotFather
	- Username Telegram-группы/канала/человека куда бот будет отправлять посты (Бот должен быть админом на канале/группе)
	- Username Telegram-группы для кнопки обсуждений (Для GetVkSetTgG.py)
	- Аккаунт на Heroku
	- Аккаунт на GitHub
 - В Heroku создаёте приложение, назовите его и укажите регион
 - В Reveal Config Vars (Settings) укажите свои KEY и VALUE (Ключи и значения)
 - Залогиньтесь в GitHub и сделайте Fork этого репозитория
 - В Deployment method (Deploy) выбирете GitHub, укажите ссылку на репозиторий и нажмите Deploy Branch
 - Дождитесь завершения
 - В Configure Dynos (Overview) нажмите на карандаш, включите ползунок, и нажмите Confirm
 - Должно всё заработать :)
 
### Ключи в Heroku:
	VKTOKEN это токен Вконтакте
	TGTOKEN это токен Telegram-бота
	CHATFORBOT это username Telegram-группы/канала/человека куда бот будет отправлять посты
		Пример: @chotamvk или -123456789012345 или 123456789
	MYGROUP это username Telegram-группы для кнопки "Обсудить" (только для GetVkSetTgG.py)
		Пример: chotamvk или оставить пустым(кнопка будет не активна)
	STIME это время в секундах через которое отправляются запросы
	
### Пример KEY и VALUE в Heroku:
![Пример KEY и VALUE](https://github.com/tlgrmku/chotamvk/raw/master/Image2.png)

### Возможные баги:
 - Название группы в Telegram не совпадает с названием группы Вконтакте
	- Причина: Возможно это связано с тем, что копируемый пост первой группы содержит ссылку на альбом из другой второй группы. API Вконтакте в этом случае выдаёт боту информацию сначала о второй группе, а потом о первой. Бот берёт название из группы которая идёт первой в списке ['groups']
	- Вариант исправления: Отдельная функция запроса к методу groups.get из API Вконтакте

 - Одинаковые посты примерно раз в сутки
	- Причина: Это связано с тем, что сервер Heroku раз в сутки перезапускается. При этом файл savedatapost создаваемый ботом удаляется. Когда создаётся новый файл бот снова выполняет запросы и посылает тот же пост.
	- Вариант исправления: Свой собственный сервер или файловое хранилище
	
 - Пропускает посты
	- Причина: Бот не успевает копировать сразу несколько вышедших друг за другом постов
	- Вариант исправления: Снизить задержку time.sleep(3) с 3 секунд до 1 секунды. Но есть риск нарваться на капчу


Автор tlgrmku.

Telegram канал где живёт бот: https://t.me/chotamvk
Telegram автора бота: https://t.me/tlgrmku
